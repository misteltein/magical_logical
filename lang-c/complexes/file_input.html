<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ファイルの読み込み</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/bf75b02c3c784390bbc4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bf75b02c3c784390bbc4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/012fb0edbe917c6a9291.css" as="style"/><link rel="stylesheet" href="/_next/static/css/012fb0edbe917c6a9291.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-aeda1f3bf8052ed05b1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-91634ffaffe9ecba3ca9.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e809c1f8b229626ff074.js" as="script"/><link rel="preload" href="/_next/static/chunks/264-4170f1ea1acffe0a5777.js" as="script"/><link rel="preload" href="/_next/static/chunks/779-f86d10d963927f7e498d.js" as="script"/><link rel="preload" href="/_next/static/chunks/433-8b1b8104038637786bba.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/lang-c/complexes/file_input-3e822029faaf3a6c22d8.js" as="script"/></head><body><div id="__next"><div><div class="sticky-top"><nav style="padding-right:7rem" class="navbar navbar-expand navbar-light bg-light"><span class="text-dark pr-3">C 言語入門</span><button aria-controls="nav2" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav2"><div class="ml-auto mr-auto navbar-nav"><div class="dropdown-divider" role="separator"></div><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">はじめに</a></div></div></div><button aria-controls="nav2" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav2"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">構文・規則</a></div></div></div><button aria-controls="nav3" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav3"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">組み合わせ</a></div></div></div><button aria-controls="nav4" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav4"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">演習</a></div></div></div><button aria-controls="nav5" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav5"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">その他</a></div></div></div></nav></div><main><div class="widthContainer_width__bLQd8"><div class="abstract_abstract__2J1_W"><h1>ファイルの読み込み</h1><p>入力に応じて動作するプログラムについてその処理が正常にできているか確かめるためにも， 入力をいくつか変えたい場合がある。 円滑に作成・修正ができるように，読み込みの部分をなるべく任意のファイルに対応できるように用意する。</p><p>関連: <a href="/lang-c/elements/literal_and_variable">リテラルと変数</a>, <a href="/lang-c/elements/output">標準出力</a>, <a href="/lang-c/elements/argv">コマンドライン引数</a>, <a href="宣言文と実行文">宣言文と実行文</a>, <a href="/lang-c/elements/operator">演算子</a>, <a href="/lang-c/elements/conditional_branch">条件分岐</a>, <a href="/lang-c/elements/loop">反復</a>, <a href="/lang-c/elements/file_input">ファイル入力</a>.</p></div><div class="documentGrid_grid__5YgcL"><div class="contentElement_element__2zPOC"><h2>全体の流れ</h2><p>読み込み用の関数を作るのではなく，main 関数に貼り付けて使うようなコードを作ることを目的とする。 ファイル名だけ任意にしておき，フォーマットと取り込み先となる変数は，貼り付けた後にプログラムの目的に合わせて 書き換えるように使うことを想定する。</p><p>目的に沿ってプログラムを作成するとき， まずは単純かつ確実に動くものを作り，それを正常にを保ちつつ，柔軟さをつけていくとよい。 例えば，今回は<ol class="mt-3 mb-3"><li>決まった名前のファイルを開けるようにする</li><li>ファイルを読み込めるようにする</li><li>ファイル名を任意に与えられるようにする</li><li>(すべての行のデータをまとめて保存する)</li><li>(フォーマットを任意に与えられるようにする)</li></ol>のようにやるべきことを分解する。この各段階で思い通りにプログラムが動いているか確かめながら進める。</p></div><div class="contentElement_element__2zPOC"><h2>決まった名前のファイルを開けるようにする</h2><p>動作を試すために sample.ssv という名前でテキストファイルを作成する 。 内容は，シンプルにするために 1 行につき整数 1 つが書かれているようなファイルにしておく。<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-txt" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><a href="/codes/lang-c/complexes/file_input/sample.ssv" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div></p><p>後々ファイルが正常に開かれていた場合にのみ続く処理が行われるようにしたいので， ファイルが正常に開けたときは何も表示されず，開けなかった場合には failed to open the file↵ と表示されるように コードを書きたい。 この部分は，<a href="/lang-c/elements/file_input">ファイル入力</a>と<a href="/lang-c/elements/conditional_branch">条件分岐</a>のページを参照して，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/open.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>のように書くことができる。</p></div><div class="contentElement_element__2zPOC"><h2>ファイルを読み込めるようにする</h2><p>読み込みがでできるのは fp が作られてから fclose されるまでの範囲なので， その間にコードを書く。</p><p>この部分も，<a href="/lang-c/elements/file_input">ファイル入力</a>を参照して，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/read.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>のように書く。 （このフォーマット &quot;%d\n&quot; と変数 num が，ファイルの内容とプログラムの用途に応じて変化する。）</p></div><div class="contentElement_element__2zPOC"><h2>ファイル名を任意に与えられるようにする</h2><p>読み込むファイルの名前を，<div><pre class="code-core prism-code language-bash" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div>のようにプログラムを実行するときに与えられるようにしたい。 （この XXX.ssv は任意のファイル名を意味している。） そのため，<a href="/lang-c/elements/argv">コマンドライン引数</a>のページを参照して，main 関数に引数を追加し，ファイル名の部分をそれで置き換えるように，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/arg.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>と書く。コマンドに書かれたファイル名は ./a.out の後なので argv の添字は 1 である。</p><p>適当な名前で新しいファイルを作り，読み込ませて思い通りに動くか確かめる。</p></div><div class="contentElement_element__2zPOC"><h2>すべての行のデータをまとめて保存する</h2><p>1 行ずつについての処理ではなく，いくつかの行のデータを使った処理が必要な場合には， それらのデータをまとめて保存する必要がある。</p><p>いくつもの変数をまとめるためには，配列が利用できる。<a href="/lang-c/elements/array">配列</a>のページを参照して， 読み込んだ内容を保存する処理を追加する。 配列は，要素の数が固定なので，（可変にもできるが入門の範囲外なので，） 予め読み込まれる要素数 SIZE が分かっている場合を想定する。</p><p>用意した要素数に比べてファイルに書かれた値の数が少ないとき，また 用意した要素数がファイルに書かれた値の数よりも少ないときに想定から外れるため， それらが生じていないかチェックするコードも追加しておいた方が不意なミスを避けられる。</p><p>最終的に，1 行ずつ読み込んで表示していた部分を，配列に値を保存するように書き換えて，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/array.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>のようなプログラムになる。異常な状態を２件を検出するためのコードも加えた。 さらに，配列のサイズをリテラルで書かなくて良いように define 文 (マクロ) を利用している。</p><p>思い通りの処理になるか調べるため，正常 1 件，異常 2 件について入力ファイルをそれぞれ用意し， それぞれの場合の出力を確かめてほしい。</p></div><div class="contentElement_element__2zPOC"><h2>フォーマットを任意に与えられるようにする</h2><p>勘がいい方は，「printf 関数など引数の数を変えられる関数があるし， フォーマットは文字列だし，関数にまとめてもっと使いやすいものができるのでは？」 と考えるかもしれない。 もちろんこれは可能であるが，入門の範囲を超えてしまうので，取り上げなかった。 可変長引数の使い方を調べれば解決できるので，余力があればぜひ試してほしい。</p></div></div></div></main></div><footer class="text-center" style="margin-top:10rem"><hr class="pb-2 pb-4 w-75"/><div class="mt-5 mb-5">(c) 2020-2021 Itoga, Hibiki (<a href="https://github.com/misteltein">@misteltein</a>).</div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/lang-c/complexes/file_input","query":{},"buildId":"jsEYDlEJ4eVTErxZr2vLN","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-aeda1f3bf8052ed05b1d.js" async=""></script><script src="/_next/static/chunks/framework-91634ffaffe9ecba3ca9.js" async=""></script><script src="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" async=""></script><script src="/_next/static/chunks/pages/_app-e809c1f8b229626ff074.js" async=""></script><script src="/_next/static/chunks/264-4170f1ea1acffe0a5777.js" async=""></script><script src="/_next/static/chunks/779-f86d10d963927f7e498d.js" async=""></script><script src="/_next/static/chunks/433-8b1b8104038637786bba.js" async=""></script><script src="/_next/static/chunks/pages/lang-c/complexes/file_input-3e822029faaf3a6c22d8.js" async=""></script><script src="/_next/static/jsEYDlEJ4eVTErxZr2vLN/_buildManifest.js" async=""></script><script src="/_next/static/jsEYDlEJ4eVTErxZr2vLN/_ssgManifest.js" async=""></script></body></html>