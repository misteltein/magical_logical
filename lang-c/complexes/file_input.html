<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ファイルの読み込み</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/3b3dd5cc410165a11ea6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3b3dd5cc410165a11ea6.css" data-n-g=""/><link rel="preload" href="/_next/static/css/012fb0edbe917c6a9291.css" as="style"/><link rel="stylesheet" href="/_next/static/css/012fb0edbe917c6a9291.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-fb2dd7aba3784ca05084.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-12e2086b9f7c442fbc96.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2-2581e1430175e894be76.js" as="script"/><link rel="preload" href="/_next/static/chunks/418-3365a3105014f18271fc.js" as="script"/><link rel="preload" href="/_next/static/chunks/779-f86d10d963927f7e498d.js" as="script"/><link rel="preload" href="/_next/static/chunks/433-8b1b8104038637786bba.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/lang-c/complexes/file_input-e5942c17602e3b5baf7b.js" as="script"/></head><body><div id="__next"><div><div class="sticky-top"><nav class="navbar navbar-expand-md navbar-light bg-light"><button aria-controls="basic-navbar-nav" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="basic-navbar-nav"><div class="ml-auto mr-auto navbar-nav"><a href="/" data-rb-event-key="/" class="nav-link"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="coffee" class="svg-inline--fa fa-coffee fa-w-20 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="width:1.5rem"><path fill="currentColor" d="M192 384h192c53 0 96-43 96-96h32c70.6 0 128-57.4 128-128S582.6 32 512 32H120c-13.3 0-24 10.7-24 24v232c0 53 43 96 96 96zM512 96c35.3 0 64 28.7 64 64s-28.7 64-64 64h-32V96h32zm47.7 384H48.3c-47.6 0-61-64-36-64h583.3c25 0 11.8 64-35.9 64z"></path></svg></a><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">C 言語</a></div></div></div></nav></div><main><div class="widthContainer_width__bLQd8"><div class="abstract_abstract__2J1_W"><h1>ファイルの読み込み</h1><p>入力に応じて動作するプログラムについてその処理が正常にできているか確かめるためにも， 入力をいくつか変えたい場合がある。 円滑に作成・修正ができるように，読み込みの部分をなるべく任意のファイルに対応できるように用意する。</p><p>前提：ファイル入力</p></div><div class="documentGrid_grid__5YgcL"><div class="contentElement_element__2zPOC"><h2>全体の流れ</h2><p>読み込み用の関数を作るのではなく，main 関数に貼り付けて使うようなコードを作ることを目的とする。 ファイル名だけ任意にしておき，フォーマットと取り込み先となる変数は，貼り付けた後にプログラムの目的に合わせて 書き換えるように使うことを想定する。</p><p>目的に沿ってプログラムを作成するとき， まずは単純かつ確実に動くものを作り，それを正常にを保ちつつ，柔軟さをつけていくとよい。 例えば，今回は<ol class="mt-3 mb-3"><li>決まった名前のファイルを開けるようにする</li><li>ファイルを読み込めるようにする</li><li>ファイル名を任意に与えられるようにする</li><li>(すべての行のデータをまとめて保存する)</li><li>(フォーマットを任意に与えられるようにする)</li></ol>のようにやるべきことを分解する。この各段階で思い通りにプログラムが動いているか確かめながら進める。</p></div><div class="contentElement_element__2zPOC"><h2>決まった名前のファイルを開けるようにする</h2><p>動作を試すために sample.ssv という名前でテキストファイルを作成する 。 内容は，シンプルにするために１行につき整数１つが書かれているようなファイルにしておく。<div style="margin:8px 0 8px 0"><div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><a href="/codes/lang-c/complexes/file_input/sample.ssv" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div></p><p>後々ファイルが正常に開かれていた場合にのみ続く処理が行われるようにしたいので， ファイルが正常に開けたときは何も表示されず，開けなかった場合には failure↵ と表示されるように コードを書きたい。 この部分は，<a href="/lang-c/elements/file_input">ファイル入力</a>と<a href="/lang-c/elements/conditional_branch">条件分岐</a>のページを参照して，<div style="margin:8px 0 8px 0"><div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/open.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>のように書くことができる。</p><p>書いただけでは，処理が思い通りできているか分からないので， 正常と異常それぞれの場合について，試してみる。 コンパイルした後，<div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div>を実行したとき，なにも表示されず，これについては狙い通りである。 次に，存在しないファイルを指定して<div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div>と実行したとき，failure↵ と表示されるので，これも思い通りである。 そのため，ここまでのプログラムは問題なさそうであることが分かる。</p></div><div class="contentElement_element__2zPOC"><h2>ファイルを読み込めるようにする</h2><p>読み込みがでできるのは fp が作られてから fclose されるまでの範囲なので， その間にコードを書く。</p><p>この部分も，<a href="/lang-c/elements/file_input">ファイル入力</a>を参照して，<div style="margin:8px 0 8px 0"><div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/read.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>のように書く。 （このフォーマット &quot;%d\n&quot; と変数 num が，ファイルの内容とプログラムの用途に応じて変化する。）</p><p>再度コンパイルしてから，<div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div>を実行すると，<div style="margin:8px 0 8px 0"><div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のように入力ファイルに書かれている整数が並ぶため，読み込みができていることが分かる。 同様のチェックを，フォーマットを変えたり変数を変えたりした場合に再び行なう。</p></div><div class="contentElement_element__2zPOC"><h2>ファイル名を任意に与えられるようにする</h2><p>読み込むファイルの名前を，<div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div>のようにプログラムを実行するときに与えられるようにしたい。 （この XXX.ssv は任意のファイル名を意味している。） そのため，<a href="/lang-c/elements/argv">コマンドライン引数</a>のページを参照して，main 関数に引数を追加し，ファイル名の部分をそれで置き換えるように，<div style="margin:8px 0 8px 0"><div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/arg.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>と書く。コマンドに書かれたファイル名は ./a.out の後なので argv の添字は 1 である。</p><p>適当な名前で新しいファイルを作り，読み込ませて思い通りに動くか確かめる。</p></div><div class="contentElement_element__2zPOC"><h2>すべての行のデータをまとめて保存する</h2><p>１行ずつについての処理ではなく，いくつかの行のデータを使った処理が必要な場合には， それらのデータをまとめて保存する必要がある。</p><p>いくつもの変数をまとめるためには，配列が利用できる。<a href="/lang-c/elements/array">配列</a>のページを参照して， 読み込んだ内容を保存する処理を追加する。 配列は，要素の数が固定なので，（可変にもできるが入門の範囲外なので，） 予め読み込まれる要素数 SIZE が分かっている場合を想定する。</p><p>用意した要素数に比べてファイルに書かれた値の数が少ないとき，また 用意した要素数がファイルに書かれた値の数よりも少ないときに想定から外れるため， それらが生じていないかチェックするコードも追加しておいた方が不意なミスを避けられる。</p><p>最終的に，一行ずつ読み込んで表示していた部分を，配列に値を保存するように書き換えて，<div style="margin:8px 0 8px 0"><div class=""><pre style="background-color:#f6f8fa;font-size:14px;padding:7px 1rem 5px 1rem;margin:0;overflow:auto;max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"><button type="button" class="btn btn-outline-dark btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="expand-alt" class="svg-inline--fa fa-expand-alt fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1rem"><path fill="currentColor" d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"></path></svg></button><a href="/codes/lang-c/complexes/file_input/array.c" download="" class="ml-1"><button type="button" class="m-0 mr-1 btn btn-outline-primary btn-md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="download" class="svg-inline--fa fa-download fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1rem"><path fill="currentColor" d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"></path></svg></button></a></div></div>のようなプログラムになる。異常な状態を２件を検出するためのコードも加えた。</p><p>思い通りの処理になるか調べるため，正常 1 件，異常 2 件について入力ファイルをそれぞれ用意し， それぞれの場合の出力を確かめてほしい。</p></div><div class="contentElement_element__2zPOC"><h2>フォーマットを任意に与えられるようにする</h2><p>勘がいい方は，「printf 関数など引数の数を変えられる関数があるし， フォーマットは文字列だし，関数にまとめてもっと使いやすいものができるのでは？」 と考えるかもしれない。 もちろんこれは可能であるが，入門の範囲を超えてしまうので，取り上げなかった。 可変長引数の使い方を調べれば解決できるので，余力があればぜひ試してほしい。</p></div></div></div></main></div><footer class="border-top text-center" style="margin-top:10rem"><div class="mt-5 mb-5">(c) 2020-2021 Itoga, Hibiki (<a href="https://github.com/misteltein">@misteltein</a>).</div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/lang-c/complexes/file_input","query":{},"buildId":"G5xD56sttHER0pCnlCuCM","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-189c53927ffd3caf09c3.js" async=""></script><script src="/_next/static/chunks/framework-fb2dd7aba3784ca05084.js" async=""></script><script src="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" async=""></script><script src="/_next/static/chunks/pages/_app-12e2086b9f7c442fbc96.js" async=""></script><script src="/_next/static/chunks/cb1608f2-2581e1430175e894be76.js" async=""></script><script src="/_next/static/chunks/418-3365a3105014f18271fc.js" async=""></script><script src="/_next/static/chunks/779-f86d10d963927f7e498d.js" async=""></script><script src="/_next/static/chunks/433-8b1b8104038637786bba.js" async=""></script><script src="/_next/static/chunks/pages/lang-c/complexes/file_input-e5942c17602e3b5baf7b.js" async=""></script><script src="/_next/static/G5xD56sttHER0pCnlCuCM/_buildManifest.js" async=""></script><script src="/_next/static/G5xD56sttHER0pCnlCuCM/_ssgManifest.js" async=""></script></body></html>