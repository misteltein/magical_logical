<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ファイル入力</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/bf75b02c3c784390bbc4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bf75b02c3c784390bbc4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/012fb0edbe917c6a9291.css" as="style"/><link rel="stylesheet" href="/_next/static/css/012fb0edbe917c6a9291.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-aeda1f3bf8052ed05b1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-91634ffaffe9ecba3ca9.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e809c1f8b229626ff074.js" as="script"/><link rel="preload" href="/_next/static/chunks/264-4170f1ea1acffe0a5777.js" as="script"/><link rel="preload" href="/_next/static/chunks/779-f86d10d963927f7e498d.js" as="script"/><link rel="preload" href="/_next/static/chunks/433-8b1b8104038637786bba.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/lang-c/elements/file_input-6857ee1ea9c66505266e.js" as="script"/></head><body><div id="__next"><div><div class="sticky-top"><nav style="padding-right:7rem" class="navbar navbar-expand navbar-light bg-light"><span class="text-dark pr-3">C 言語入門</span><button aria-controls="nav2" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav2"><div class="ml-auto mr-auto navbar-nav"><div class="dropdown-divider" role="separator"></div><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">はじめに</a></div></div></div><button aria-controls="nav2" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav2"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">構文・規則</a></div></div></div><button aria-controls="nav3" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav3"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">組み合わせ</a></div></div></div><button aria-controls="nav4" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav4"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">演習</a></div></div></div><button aria-controls="nav5" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="nav5"><div class="ml-auto mr-auto navbar-nav"><div class="nav-item dropdown"><a aria-haspopup="true" aria-expanded="false" id="basic-nav-dropdown" href="#" class="dropdown-toggle nav-link" role="button">その他</a></div></div></div></nav></div><main><div class="widthContainer_width__bLQd8"><div class="abstract_abstract__2J1_W"><h1>ファイル入力</h1><p>ファイル，特にテキストファイルの入力は，プログラムの処理に必要なデータを与えるために使われる。</p></div><div class="documentGrid_grid__5YgcL"><div class="contentElement_element__2zPOC"><h2>fopen を使ったファイルの開閉</h2><p>ファイルの内容を読み込むためには，まずそのファイルを開かなければならない。 fopen はそのための関数である。 この関数にファイルのパスと，開いたファイルの扱い方を引数として与えることでファイルが開かれる。 例えば，プログラムを実行するディレクトリにある hoo.ssv というファイルを読み取り専用で開く場合には，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のように書く。 fopen はファイルポインタという FILE* 型の特殊なデータを返すため， ここではそれを fp という名前で定義した。 このファイルポインタはファイルのどこの部分を扱っているのかという情報を持っている。 そして，これが指す位置をずらしながらファイルを読み込む。&quot;r&quot; は読み取り専用にするために指定している。</p><p>ファイルが存在しない場合などには，fopen は NULL という特殊な値を返す。 そのため，fp の値が NULL になっていないか目的の処理の前に<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のようにチェックしたほうがよい。</p><p>ファイルの読み込みが終わった段階で，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のように，閉じる作業を書く。これを怠ると，取得したメモリを開放できない問題（メモリリーク） が引き起こされる。</p></div><div class="contentElement_element__2zPOC"><h2>fscanf を使った読み込み</h2><p>正常に開かれた場合には， ファイルポインタを使って，fscanf を使ってファイルの内容を取り込むことができる。 fscanf の引数は，ファイルポインタ，入力フォーマット指定子， 値を取り込ませる変数である。 例えば，ファイルの１行（整数が書かれている）を読み取って int 型の 変数 num に読み込む場合には，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のように書く。この変数名の前に付いている &amp; は，その変数のメモリ上のアドレスを取り出すための演算子である。 そのアドレスに，取り出した値が置かれることで変数にファイルの一部が読み込まれる。</p><p>１行を複数の値に分けて取り込む場合には，フォーマットを変えて，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のように書く。 このように，取り込む先の変数は任意の数にできる。</p><p>読み込みが終わった時点で，ファイルポインタは， 読み込んだ分だけ後方にずれる。 また，fscanf はファイルが終了していて，これ以上読み込めない状態で EOF (End of File) という特殊な値を返す。 これらを利用し，<div style="margin:8px 0 8px 0"><div><pre class="code-core prism-code language-c" style="max-height:15rem"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></pre></div><div style="text-align:right;padding:5px 0 5px 0"></div></div>のように，ファイルの全ての行を繰り返し読みこむことができる。</p><p>入力フォーマット指定子は，出力の際に使っているフォーマット指定子とほぼ同じであるが， double 型の変数に入力する場合には，%f ではなく %lf を指定する必要がある。</p></div></div></div></main></div><footer class="text-center" style="margin-top:10rem"><hr class="pb-2 pb-4 w-75"/><div class="mt-5 mb-5">(c) 2020-2021 Itoga, Hibiki (<a href="https://github.com/misteltein">@misteltein</a>).</div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/lang-c/elements/file_input","query":{},"buildId":"HntwI4lzoEWN6Ei9lB6IH","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-eef578260fd80f8fff94.js"></script><script src="/_next/static/chunks/webpack-aeda1f3bf8052ed05b1d.js" async=""></script><script src="/_next/static/chunks/framework-91634ffaffe9ecba3ca9.js" async=""></script><script src="/_next/static/chunks/main-71948af4b0f09c0fc30e.js" async=""></script><script src="/_next/static/chunks/pages/_app-e809c1f8b229626ff074.js" async=""></script><script src="/_next/static/chunks/264-4170f1ea1acffe0a5777.js" async=""></script><script src="/_next/static/chunks/779-f86d10d963927f7e498d.js" async=""></script><script src="/_next/static/chunks/433-8b1b8104038637786bba.js" async=""></script><script src="/_next/static/chunks/pages/lang-c/elements/file_input-6857ee1ea9c66505266e.js" async=""></script><script src="/_next/static/HntwI4lzoEWN6Ei9lB6IH/_buildManifest.js" async=""></script><script src="/_next/static/HntwI4lzoEWN6Ei9lB6IH/_ssgManifest.js" async=""></script></body></html>